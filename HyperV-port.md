### hyper-v占用常用端口
hyper-v占用常用端口导致部分端口无法被其他程序正常使用

1. 查看 Hyper-v 启动后的保留端口范围 [[参考]][excludedportrange]
```
$ netsh interface ipv4 show excludedportrange protocol=tcp

协议 tcp 端口排除范围

开始端口    结束端口
----------    --------
      1066        1165
      1166        1265
      1266        1365
      1366        1465
      1466        1565
      1566        1665
      1666        1765
      1766        1865
      1866        1965
      1966        2065
      2066        2165
      2180        2279
      2280        2379
      2484        2583
      2584        2683
      2684        2783
      2784        2883
      2884        2983
      2984        3083
      3084        3183
      3184        3283
      3284        3383
      3390        3489
      3490        3589
      3590        3689
      3690        3789
      3913        4012
      4013        4112
      4113        4212
      4213        4312
      4313        4412
      4413        4512
      4513        4612
      4613        4712
      4713        4812
      4813        4912
      4913        5012
      5013        5112
      5113        5212
      5357        5357
      5558        5657
      5658        5757
      5758        5857
      5858        5957
      5958        6057
      6058        6157
      6158        6257
      6258        6357
      6358        6457
      6458        6557
      6558        6657
      6658        6757
      6758        6857
      7294        7393
      7394        7493
      7494        7593
      7681        7780
      7781        7880
      7881        7980
      7981        8080
      8081        8180
      8181        8280
      8281        8380
      8381        8480
      8481        8580
      8581        8680
      9302        9401
      9402        9501
      9502        9601
      9602        9701
      9702        9801
     27339       27339
     50000       50059     *

* - 管理的端口排除。

```



2. 发现7890端口被保留，clash无法使用(clash默认使用7890端口，用习惯了就不换了)，再看下动态端口范围 [[参考]][dynamicportrange]
```
$ netsh interface ipv4 show dynamicportrange protocol=tcp

协议 tcp 动态端口范围
---------------------------------
启动端口        : 1024
端口数          : 13977

```
3. 发现分配了1024为起始端口，共计13K+个端口数，这里变更下端口范围
```
# netsh interface ipv4 set dynamicportrange protocol=tcp startport=50000 numberofports=10000

确定。

```

4. 完成后重启，再次使用上述命令查看端口分配是否生效。

[^_^]:
    参考地址
    
[excludedportrange]: <https://tanxy.club/2023/Clash-Port0> (点击打开)
[dynamicportrange]: <https://zhaoji.wang/solve-the-problem-of-windows-10-ports-being-randomly-reserved-occupied-by-hyper-v/> (点击打开)
